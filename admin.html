<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Student Details</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="./public/admin.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3 sidebar">
                <div class="logo">
                    <img src="./public/images/logo3.png" alt="College Logo" style="max-width: 100px;">
                    <br>
                    <img src="./public/images/logo2.jpeg.png" alt="College Logo" style="max-width: 200px;">
                </div>
                <div class="college-address">
                    Nehru Nagar,Civil Aerodrome Post, <br> Coimbatore - 641014
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="#" id="dashboardLink">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" id="allStudentsLink">All Students Details</a></li>
                    <li class="nav-item"><a class="nav-link" href="/student.html">Add Students</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" id="seatsAllocationLink">Seat Allocation</a></li> 
                    <li class="nav-item"><a class="nav-link" href="#" id="feesStructureSidebarLink">Fees Structure</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" id="studentFeesDetailsLink">Student Fees Details</a></li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                Export
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                                <!-- <li><a class="dropdown-item" href="#" onclick="exportToExcel()">Export to Excel</a></li> -->
                                <li><a class="dropdown-item" href="#" onclick="fetchAndExport()">Export to CSV</a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" href="#" onclick="logout()">Logout</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-9 main-content">
                 
                <div id="dashboardContent"></div>
                <div id="studentDetailsContent" style="display: none;">
                    <button onclick="goBackToDashboard()" class="btn btn-outline-primary">⬅ Back to Dashboard</button>

                    <h1>Admin - Student Details</h1>
                    <div class="d-flex align-items-center mb-3" style="gap: 10px;">
                        <!-- Search Bar -->
                        <div class="flex-grow-1">
                            <input type="text" id="searchBar" class="form-control" placeholder="Search students..." onkeyup="searchTable()">
                        </div>
                        
                        <!-- Filter Controls -->
                        <div class="d-flex align-items-center" style="gap: 10px;">
                            <select id="filterCategory" class="form-control">
                                <option value="">Select Category</option>
                                <option value="department">Department</option>
                                <option value="admissionStatus">Admission Status</option>
                                <option value="community">Community</option>
                                <option value="hostel">Hostel/Day Scholar</option>
                                <option value="regular">Regular/Lateral</option>
                                <option value="bloodGroup">Blood Group</option>
                                <option value="batch">Batch</option>
                                <option value="referredBy">Referred By</option>
                                <option value="first">First Graduate</option>
                            </select>
                            
                            <select id="filterValue" class="form-control">
                                <option value="">Select Value</option>
                            </select>
                            
                            <button id="filterButton" class="btn btn-primary">Filter</button>
                            <button id="resetButton" class="btn btn-secondary">Reset</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="studentTable">
                            <thead>
                                <tr>
                                    <th style="width: 5%; min-width: 50px;">S.No</th>
                                    <th style="width: 8%; min-width: 80px; ">Application No</th>
                                    <th style="width: 22%; min-width: 180px;">Name</th> <!-- Increased from 18% -->
                                    <th style="width: 35%; min-width: 200px;">Department</th>
                                    <th style="width: 10%; min-width: 110px;">Admission Status</th> <!-- Decreased from 12% -->
                                    <th style="width: 10%; min-width: 110px;">Application Status</th> <!-- Decreased from 12% -->
                                    <th style="width: 3%; min-width: 70px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody"></tbody>
                        </table>
                        <div class="pagination-controls" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;">
                            <button id="prevPage" class="btn btn-secondary" style="background-color: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Previous</button>
                            <span id="pageInfo" style="color: #333; font-weight: bold;">Page 1</span>
                            <button id="nextPage" class="btn btn-secondary" style="background-color: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Next</button>
                        </div>
                    </div>
                </div>
            
                <div id="studentFeesDetailsContent" style="display: none;">
                    <button onclick="goBackToDashboard()" class="btn btn-outline-primary">⬅ Back to Dashboard</button>

                    <h1>Student Fees Details</h1>
                    <div class="d-flex align-items-center mb-3" style="gap: 10px;">
                        <!-- Search Bar -->
                        <div class="flex-grow-1">
                            <input type="text" id="searchBarFees" class="form-control" placeholder="Search students..." onkeyup="searchFeesTable()">
                        </div>
                        
                        <!-- Filter Controls -->
                        <div class="d-flex align-items-center" style="gap: 10px;">
                            <select id="filterFeesCategory" class="form-control">
                                <option value="">Select Category</option>
                                <option value="department">Department</option>
                                <option value="community">Community</option>
                                <option value="hostel">Hostel</option>
                                <option value="regular">Regular</option>
                                <option value="bloodGroup">Blood Group</option>
                                <option value="batch">Batch</option>
                                <option value="first">First Graduate</option>
                                <option value="feesStatus">Fees Status</option>
                            </select>
                            
                            <select id="filterFeesValue" class="form-control">
                                <option value="">Select Value</option>
                            </select>
                            
                            <button id="filterFeesButton" class="btn btn-primary" onclick="filterFees()">Filter</button>
                            <button id="resetFeesButton" class="btn btn-secondary" onclick="resetFeesFilters()">Reset</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="studentFeesTable">
                            <thead>
                                <tr>
                                    <th style="width: 5%; min-width: 50px;">S.No</th>
                                    <th style="width: 10%; min-width: 100px;">Application No</th>
                                    <th style="width: 38%; min-width: 220px;">Name</th>
                                    <th style="width: 40%; min-width: 240px;">Department</th>
                                    <th style="width: 7%; min-width: 40px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentFeesTableBody"></tbody>
                        </table>
                        <div class="pagination-controls" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;">
                            <button id="prevPageFees" class="btn btn-secondary" style="background-color: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Previous</button>
                            <span id="pageInfoFees" style="color: #333; font-weight: bold;">Page 1</span>
                            <button id="nextPageFees" class="btn btn-secondary" style="background-color: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Next</button>
                        </div>
                    </div>
                </div>

                <div id="seatsAllocationContent" style="display: none;">
                    <button onclick="goBackToDashboard()" class="btn btn-outline-primary">⬅ Back to Dashboard</button>

                    <h1>Seat Allocation</h1>
                    <div id="seatsAllocationGrid" class="seats-container"></div>
                </div>
                <div id="feeTableContainer" style="display: none;" class="table-responsive mt-3">
                    <button onclick="goBackToDashboard()" class="btn btn-outline-primary">⬅ Back to Dashboard</button>

                    <h1>Fees Structure</h1>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th rowspan="2">Branch</th>
                                <th colspan="4" class="text-center">Tuition Fees</th>
                                <th colspan="2" class="text-center">Hostel Fees</th>
                                <th rowspan="2">Actions</th>
                            </tr>
                            <tr>
                                <th>FG</th>
                                <th>Non-FG</th>
                                <th>GQ</th>
                                <th>MQ</th>
                                <th>BC/MBC</th>
                                <th>SC/ST</th>
                            </tr>
                        </thead>
                        <tbody id="feeTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="studentDetailsModal" tabindex="-1" aria-labelledby="studentDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentDetailsModalLabel">Student Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="studentDetailsModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this student? This action cannot be undone.</p>
                    <p class="text-muted">All associated data will be permanently removed.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="missingFieldsModal" tabindex="-1" aria-labelledby="missingFieldsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="missingFieldsModalLabel">Missing Fields</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="missingFieldsList"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
   
    <div class="modal fade" id="individualFeesModal" tabindex="-1" aria-labelledby="individualFeesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="individualFeesModalLabel">Fees Details for <span id="studentName"></span> (<span id="studentApplicationNo"></span>)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="individualFeesModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/admin.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>