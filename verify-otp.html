<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify OTP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="card p-4 shadow-lg" style="max-width: 400px; width: 100%;">
            <h3 class="text-center">ðŸ“© Verify OTP</h3>

            <p class="text-muted text-center">Enter the OTP sent to your email.</p>

            <form id="verifyForm">
                <div class="mb-3">
                    <label for="email" class="form-label">ðŸ“§ Email</label>
                    <input type="email" id="email" name="email" class="form-control" required />
                </div>

                <div class="mb-3">
                    <label for="otp" class="form-label">ðŸ”¢ OTP</label>
                    <input type="text" id="otp" name="otp" class="form-control" required />
                </div>

                <button type="submit" class="btn btn-primary w-100">Verify OTP</button>
            </form>

            <p class="mt-3 text-center"><a href="/forgot-password">ðŸ”„ Resend OTP</a></p>
        
    </div>
</div>
<script>
    document.getElementById("verifyForm").addEventListener("submit", async function (event) {
            event.preventDefault(); // Prevent page reload
            const email = document.getElementById("email").value;
            const otp = document.getElementById("otp").value;


            try {
                const baseUrl = "https://sce-admission-be.onrender.com"; // Correctly define base URL
                const response = await fetch(`${baseUrl}/verify-otp`, {  // Use baseUrl in API call
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({email, otp })
                });

                const data = await response.json();
                console.log('data', data)

                if (response.ok) {
                    messageDiv.innerHTML = `<div class="success">${data.message || `OTP Verified Sucessfully!`}</div>`;
                    //document.getElementById("verifyForm").reset(); // Clear the form
                    setTimeout(() => {
                        window.location.href = "reset-password.html";
                    }, 2000);
                } else {
                    messageDiv.innerHTML = `<div class="error">${data.error || "OTP Verfication Failed"}</div>`;
                }
            } catch (error) {
                messageDiv.innerHTML = `<div class="error">Error: Unable to connect to server</div>`;
            }
        });




    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }
    setTimeout(() => {
            messageBox.innerHTML = "";
        }, 5000);

    window.onload = function () {
        const errorMessage = getQueryParam("error");

        if (errorMessage) {
            const errorDiv = document.createElement("div");
            errorDiv.className = "alert alert-danger";
            errorDiv.innerText = decodeURIComponent(errorMessage);
            document.querySelector(".card").prepend(errorDiv);
        }
    };
</script>
<script src="./js/main.js"></script>

</body>
</html>
